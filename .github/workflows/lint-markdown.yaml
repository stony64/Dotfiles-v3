# ------------------------------------------------------------------------------
# FILE:          .github/workflows/lint-markdown.yml
# VERSION:       1.3.0
# DESCRIPTION:   GitHub Action: Markdown Linting mit SARIF Annotations (v19.1.2).
# AUTHOR:        [User] - Proxmox/Debian Dotfiles + Inline Comments
# ------------------------------------------------------------------------------

name: "üìù Lint Markdown"

on:
  push:
    branches: [main, master, "release/**"]
    paths:
      - "**/*.md"
      - ".markdownlint*"
      - "markdownlint-cli2.jsonc"
      - ".github/workflows/lint-markdown.yml"
  pull_request:
    branches: [main, master]
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

permissions:
  contents: read
  pull-requests: write
  checks: write

jobs:
  markdownlint:
    name: "üîç Markdown Linting"
    runs-on: ubuntu-latest

    steps:
      - name: üì• Checkout Repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: üîç Run markdownlint-cli2
        uses: DavidAnson/markdownlint-cli2-action@v19.1.2
        with:
          config_file: markdownlint-cli2.jsonc
          globs: |
            **/*.md
            README.md
          report: report.json
        continue-on-error: false

      - name: üìä Upload SARIF (Annotations)
        if: always()
        uses: github/codeql-action/upload-sarif@v3
        with:
          sarif_file: report.sarif
          checkout_path: ${{ github.workspace }}

      - name: üìù Job Summary
        if: always()
        run: |
          echo "### Markdown Linting Status: ${{ job.status }}"

          if [[ "${{ job.status }}" == "success" ]]; then
            echo ""
            echo "‚úÖ **Alle Markdown-Dateien** entsprechen Style-Guide v1.4.2"
            echo "**Files checked:** $(find . -name '*.md' | wc -l | xargs)"
            echo "**Linting config:** [markdownlint-cli2.jsonc](markdownlint-cli2.jsonc)"
          else
            echo ""
            echo "‚ùå **Linting-Fehler** gefunden ‚Üí siehe **Annotations**!"
            echo "**Fix Annotations:** Files changed Tab (rot hervorgehoben)"
            echo "**Config:** [markdownlint-cli2.jsonc](markdownlint-cli2.jsonc)"
          fi

          echo ""
          echo "---"
          echo "*Triggered by:* ${{ github.event_name }} #${{ github.run_number }}"
        shell: bash
